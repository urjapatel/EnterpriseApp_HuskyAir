package com.ur.spring.finalex.service;

import java.time.LocalDate;
import java.util.UUID;

import org.springframework.stereotype.Service;

import com.ur.spring.finalex.model.AirlineTicket;
import com.ur.spring.finalex.model.Payment;
import com.ur.spring.finalex.model.Reservation;
import com.ur.spring.finalex.repository.AirlineTicketRepository;

@Service
public class TicketService {
 
 private final AirlineTicketRepository ticketRepository;
 
 public AirlineTicket generateTicket(Reservation reservation, Payment payment) {
     AirlineTicket ticket = new AirlineTicket();
     ticket.setReservationId(reservation.getId());
     ticket.setNumber(generateTicketNumber());
     ticket.setPrice(payment.getAmount());
     ticket.setStatus(payment.getStatus().equals("COMPLETED") ? "ISSUED" : "PENDING_PAYMENT");
     return ticketRepository.save(ticket);
 }
 
 public void issueTicket(AirlineTicket ticket) {
     ticket.setStatus("ISSUED");
     ticket.setIssueDate(LocalDate.now());
     ticketRepository.save(ticket);
 }
 
 private String generateTicketNumber() {
     return "TK" + UUID.randomUUID().toString().substring(0, 8).toUpperCase();
 }
}